resources:
  - name: pipeline
    type: git
    source:
      uri: https://github.com/suhlig/pmc-notification
      branch: master
      paths: ["tasks/*"]

  - name: runtime-pmc-notes
    type: git
    source:
      uri: https://github.com/cloudfoundry/pmc-notes
      branch: master
      paths: ["Runtime/*"]

  - name: runtime-pmc-meetings
    type: icalendar
    source:
      url: 'https://www.google.com/calendar/ical/cloudfoundry.org_8ms13q67p9jjeeilng6dosnu50@group.calendar.google.com/public/basic.ics'
      range: yesterday

jobs:
  - name: Notify on new Runtime PMC notes
    plan:
      - get: runtime-pmc-notes
        trigger: true

      - get: pipeline
        trigger: false

      - task: Convert Markdown to HTML
        file: pipeline/tasks/md2html/task.yml
        input_mapping:
          - markdown: runtime-pmc-notes
        params:
          HTML_FILE: html/output.html
        attempts: 3

      - task: Send notification
        file: pipeline/tasks/notification/task.yml
        params:
          MAILGUN_API_KEY: {{mailgun-api-key}}
          SUBJECT: Runtime PMC Meeting Notes
          HTML_FILE: html/output.html
